<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext
http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd
http://www.liquibase.org/xml/ns/dbchangelog
http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet author="NIILZON" id="create_user_table">
        <comment>USER table creation</comment>
        <sql>
            <![CDATA[

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Table USER
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS USER (
  id BIGINT NOT NULL AUTO_INCREMENT,
  username VARCHAR(20) NOT NULL,
  email VARCHAR(250) NOT NULL,
  password VARCHAR(100) NOT NULL,
  enabled INT(1) NOT NULL DEFAULT 0,
  created DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  modified DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  passwordfailures INT NOT NULL DEFAULT 0,
  resettoken VARCHAR(250),
  resettokeninternal VARCHAR(250),
  resettokenexpiration DATETIME,
  PRIMARY KEY (id),
  UNIQUE INDEX c_user_username (username ASC),
  UNIQUE INDEX c_user_email (email ASC))
ENGINE = InnoDB;
]]>
        </sql>
    </changeSet>

    <changeSet author="NIILZON" id="add_column_confirmation_token_to_user">
        <comment>
            Addition of the "CONFIRMATIONTOKEN" column to the user table, which is used to email-confirm newly registered accounts
        </comment>
        <sql>
            <![CDATA[
                ALTER TABLE USER ADD COLUMN confirmationtoken VARCHAR(50);
            ]]>
        </sql>
    </changeSet>

</databaseChangeLog>